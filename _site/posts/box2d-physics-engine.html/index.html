<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Box2D–Physics Engine" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="Demo Box2D是一个强大的物理引擎(Physics Engine)，有c++, java, js等多种版本。当前流行的Angry birds游戏就使用它作为物理引擎。Wikipedia中给出的定义是： A physics engine is computer software that provides an approximate simulation of certain simple physical systems, such as rigid body dynamics(including collision detection), soft body dynamics, and fluid dynamics, of use in the domains of computer graphics, video games and film. Their main uses are in video games (typically as middleware), in which case the simulations are in real-time. The term is sometimes used more generally to describe any software system for simulating physical phenomena, such as high-performance scientific simulation. 近期为了给Tankcraft做spike，实现了一个简单的坦克，包括的功能有： 左右键控制坦克前后移动 上下键调整炮筒的角度 空格键发射炮弹，根据炮筒角度不同炮弹运行的抛物线也不一样 当运行到有坡度的地面时，坦克整体布局不发生改变 其中关键技术点包括： Body: 在Box2D中，整个界面成为一个World，World中可以创建多个不同的Body，Body可以具有质量，摩擦力，位置，形状等等属性。例如上图中坦克的底座，操作舱，轮子，炮筒，炮弹，斜坡，四周方框都是Body。Body共有三种： staticBody：不能有任何移动和变化。例如，四周方框和斜坡 dynamicBody: 可以任意移动变化。除过方框和斜坡外的其余部分都是这种类型 kinematicBody：通常用于给定初始速度后可以移动的物体 Body Joint: 多个Body之间可能毫无关系，也可能紧密结合，Body Joint就是用来处理不同Body之间关系的一个对象。共有9种Joint： Distance Joint Friction Joint Gear Joint Line Joint Mouse Joint Prismatic Joint Pulley Joint Revolute Joint Weld Joint 有一篇blog对joint讲解的非常详细：，这里不再详述每种joint的适用场景。只简单列举用到的两种： Weld Joint: 这应该是最简单最直接的一种连接，就是将两个Body绑定在某个点上。例如操作舱和坦克底部，它们彼此绑定而且没有相对移动。 1 2 3 4 joint = new b2WeldJointDef; var car_body_position = car_body.GetPosition() joint.Initialize(car_body, car_head, new b2Vec2(car_body_position.x - 50/30, car_body_position.y)); world.CreateJoint(joint) Revolute Joint：这种方式是用来处理两个Body之间旋转的一种连接，例如车轮和底座之间，以及炮筒与操作舱之间。 1 2 3 4 5 6 7 var joint = new b2RevoluteJointDef; var joint_point = new b2Vec2(car_head.GetWorldCenter().x + 25/30, car_head.GetWorldCenter().y) joint.Initialize(gun, car_head, joint_point); joint.enableLimit = true; joint.referenceAngle = 20 * Math.PI / 180 gun_joint = world.CreateJoint(joint) 这里定义了在Joint时两个Body的初始角度差。另外要特别注意的就是，定义的joint_point是car_head的最后端，而gun的Position一定要根据car_head的Position设置正确，保证gun的最左端与joint_point重合，否则无法实现合理的绕joint_point旋转的效果！ ApplyImpulse: 这个用来给发出的炮弹初始速度以及角度。由于炮弹必须要沿着炮筒的方向，所以需要理解这个方法的参数含义，并且考虑几个关键点坐标来计算。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 var bulletDef = new b2BodyDef; bulletDef.type = b2Body.b2_dynamicBody; fixDef.shape = new b2CircleShape( 4/30 ); fixDef.friction = 4 fixDef.density = 2 fixDef.filter.groupIndex = 1; var gun_joint_position = gun_joint.GetAnchorA() bulletDef.position = new b2Vec2(2 * gun.GetPosition().x - gun_joint_position.x, 2 * gun.GetPosition().y - gun_joint_position.y); var bullet=world.CreateBody(bulletDef); bullet.CreateFixture(fixDef); bullet.ApplyImpulse(new b2Vec2(gun.GetPosition().x - gun_joint_position.x, gun.GetPosition().y - gun_joint_position.y), gun_joint_position) 以下是一些有用的链接： http://www.box2dflash.org/docs/2.1a/reference http://www.box2d.org/manual.html http://blog.allanbishop.com/box2d1a-tutorial-part-2-joints http://www.box2d.org/index.html" />
<meta property="og:description" content="Demo Box2D是一个强大的物理引擎(Physics Engine)，有c++, java, js等多种版本。当前流行的Angry birds游戏就使用它作为物理引擎。Wikipedia中给出的定义是： A physics engine is computer software that provides an approximate simulation of certain simple physical systems, such as rigid body dynamics(including collision detection), soft body dynamics, and fluid dynamics, of use in the domains of computer graphics, video games and film. Their main uses are in video games (typically as middleware), in which case the simulations are in real-time. The term is sometimes used more generally to describe any software system for simulating physical phenomena, such as high-performance scientific simulation. 近期为了给Tankcraft做spike，实现了一个简单的坦克，包括的功能有： 左右键控制坦克前后移动 上下键调整炮筒的角度 空格键发射炮弹，根据炮筒角度不同炮弹运行的抛物线也不一样 当运行到有坡度的地面时，坦克整体布局不发生改变 其中关键技术点包括： Body: 在Box2D中，整个界面成为一个World，World中可以创建多个不同的Body，Body可以具有质量，摩擦力，位置，形状等等属性。例如上图中坦克的底座，操作舱，轮子，炮筒，炮弹，斜坡，四周方框都是Body。Body共有三种： staticBody：不能有任何移动和变化。例如，四周方框和斜坡 dynamicBody: 可以任意移动变化。除过方框和斜坡外的其余部分都是这种类型 kinematicBody：通常用于给定初始速度后可以移动的物体 Body Joint: 多个Body之间可能毫无关系，也可能紧密结合，Body Joint就是用来处理不同Body之间关系的一个对象。共有9种Joint： Distance Joint Friction Joint Gear Joint Line Joint Mouse Joint Prismatic Joint Pulley Joint Revolute Joint Weld Joint 有一篇blog对joint讲解的非常详细：，这里不再详述每种joint的适用场景。只简单列举用到的两种： Weld Joint: 这应该是最简单最直接的一种连接，就是将两个Body绑定在某个点上。例如操作舱和坦克底部，它们彼此绑定而且没有相对移动。 1 2 3 4 joint = new b2WeldJointDef; var car_body_position = car_body.GetPosition() joint.Initialize(car_body, car_head, new b2Vec2(car_body_position.x - 50/30, car_body_position.y)); world.CreateJoint(joint) Revolute Joint：这种方式是用来处理两个Body之间旋转的一种连接，例如车轮和底座之间，以及炮筒与操作舱之间。 1 2 3 4 5 6 7 var joint = new b2RevoluteJointDef; var joint_point = new b2Vec2(car_head.GetWorldCenter().x + 25/30, car_head.GetWorldCenter().y) joint.Initialize(gun, car_head, joint_point); joint.enableLimit = true; joint.referenceAngle = 20 * Math.PI / 180 gun_joint = world.CreateJoint(joint) 这里定义了在Joint时两个Body的初始角度差。另外要特别注意的就是，定义的joint_point是car_head的最后端，而gun的Position一定要根据car_head的Position设置正确，保证gun的最左端与joint_point重合，否则无法实现合理的绕joint_point旋转的效果！ ApplyImpulse: 这个用来给发出的炮弹初始速度以及角度。由于炮弹必须要沿着炮筒的方向，所以需要理解这个方法的参数含义，并且考虑几个关键点坐标来计算。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 var bulletDef = new b2BodyDef; bulletDef.type = b2Body.b2_dynamicBody; fixDef.shape = new b2CircleShape( 4/30 ); fixDef.friction = 4 fixDef.density = 2 fixDef.filter.groupIndex = 1; var gun_joint_position = gun_joint.GetAnchorA() bulletDef.position = new b2Vec2(2 * gun.GetPosition().x - gun_joint_position.x, 2 * gun.GetPosition().y - gun_joint_position.y); var bullet=world.CreateBody(bulletDef); bullet.CreateFixture(fixDef); bullet.ApplyImpulse(new b2Vec2(gun.GetPosition().x - gun_joint_position.x, gun.GetPosition().y - gun_joint_position.y), gun_joint_position) 以下是一些有用的链接： http://www.box2dflash.org/docs/2.1a/reference http://www.box2d.org/manual.html http://blog.allanbishop.com/box2d1a-tutorial-part-2-joints http://www.box2d.org/index.html" />
<link rel="canonical" href="http://localhost:4000/posts/box2d-physics-engine.html/" />
<meta property="og:url" content="http://localhost:4000/posts/box2d-physics-engine.html/" />
<meta property="og:site_name" content="姜鹏的博客" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-04-17T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Box2D–Physics Engine" />
<meta name="twitter:site" content="@peng_jiang" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2011-04-17T00:00:00+08:00","datePublished":"2011-04-17T00:00:00+08:00","description":"Demo Box2D是一个强大的物理引擎(Physics Engine)，有c++, java, js等多种版本。当前流行的Angry birds游戏就使用它作为物理引擎。Wikipedia中给出的定义是： A physics engine is computer software that provides an approximate simulation of certain simple physical systems, such as rigid body dynamics(including collision detection), soft body dynamics, and fluid dynamics, of use in the domains of computer graphics, video games and film. Their main uses are in video games (typically as middleware), in which case the simulations are in real-time. The term is sometimes used more generally to describe any software system for simulating physical phenomena, such as high-performance scientific simulation. 近期为了给Tankcraft做spike，实现了一个简单的坦克，包括的功能有： 左右键控制坦克前后移动 上下键调整炮筒的角度 空格键发射炮弹，根据炮筒角度不同炮弹运行的抛物线也不一样 当运行到有坡度的地面时，坦克整体布局不发生改变 其中关键技术点包括： Body: 在Box2D中，整个界面成为一个World，World中可以创建多个不同的Body，Body可以具有质量，摩擦力，位置，形状等等属性。例如上图中坦克的底座，操作舱，轮子，炮筒，炮弹，斜坡，四周方框都是Body。Body共有三种： staticBody：不能有任何移动和变化。例如，四周方框和斜坡 dynamicBody: 可以任意移动变化。除过方框和斜坡外的其余部分都是这种类型 kinematicBody：通常用于给定初始速度后可以移动的物体 Body Joint: 多个Body之间可能毫无关系，也可能紧密结合，Body Joint就是用来处理不同\bBody之间关系的一个对象。共有9种Joint： Distance Joint Friction Joint Gear Joint Line Joint Mouse Joint Prismatic Joint Pulley Joint Revolute Joint Weld Joint 有一篇blog对joint讲解的非常详细：，这里不再详述每种joint的适用场景。只简单列举用到的两种： Weld Joint: 这应该是最简单最直接的一种连接，就是将两个Body绑定在某个点上。例如操作舱和坦克底部，它们彼此绑定而且没有相对移动。 1 2 3 4 joint = new b2WeldJointDef; var car_body_position = car_body.GetPosition() joint.Initialize(car_body, car_head, new b2Vec2(car_body_position.x - 50/30, car_body_position.y)); world.CreateJoint(joint) Revolute Joint：这种方式是用来处理两个Body之间旋转的一种连接，例如车轮和底座之间，以及炮筒与操作舱之间。 1 2 3 4 5 6 7 var joint = new b2RevoluteJointDef; var joint_point = new b2Vec2(car_head.GetWorldCenter().x + 25/30, car_head.GetWorldCenter().y) joint.Initialize(gun, car_head, joint_point); joint.enableLimit = true; joint.referenceAngle = 20 * Math.PI / 180 gun_joint = world.CreateJoint(joint) 这里定义了在Joint时两个Body的初始角度差。另外要特别注意的就是，定义的joint_point是car_head的最后端，而gun的Position一定要根据car_head的Position设置正确，保证gun的最左端与joint_point重合，否则无法实现合理的绕joint_point旋转的效果！ ApplyImpulse: 这个用来给发出的炮弹初始速度以及角度。由于炮弹必须要沿着炮筒的方向，所以需要理解这个方法的参数含义，并且考虑几个关键点坐标来计算。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 var bulletDef = new b2BodyDef; bulletDef.type = b2Body.b2_dynamicBody; fixDef.shape = new b2CircleShape( 4/30 ); fixDef.friction = 4 fixDef.density = 2 fixDef.filter.groupIndex = 1; var gun_joint_position = gun_joint.GetAnchorA() bulletDef.position = new b2Vec2(2 * gun.GetPosition().x - gun_joint_position.x, 2 * gun.GetPosition().y - gun_joint_position.y); var bullet=world.CreateBody(bulletDef); bullet.CreateFixture(fixDef); bullet.ApplyImpulse(new b2Vec2(gun.GetPosition().x - gun_joint_position.x, gun.GetPosition().y - gun_joint_position.y), gun_joint_position) 以下是一些有用的链接： http://www.box2dflash.org/docs/2.1a/reference http://www.box2d.org/manual.html http://blog.allanbishop.com/box2d1a-tutorial-part-2-joints http://www.box2d.org/index.html","headline":"Box2D–Physics Engine","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/box2d-physics-engine.html/"},"url":"http://localhost:4000/posts/box2d-physics-engine.html/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Box2D--Physics Engine | 姜鹏的博客
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="姜鹏的博客">
<meta name="application-name" content="姜鹏的博客">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>

  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">姜鹏的博客</a>
    </div>
    <div class="site-subtitle font-italic">创业、管理、技术</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>首页</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>分类</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>标签</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>归档</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>关于</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="https://github.com/warmwind" aria-label="github"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/peng_jiang" aria-label="twitter"
        
        
          
          target="_blank"
        

        

        rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['pengj0520','gmail.com'].join('@')" aria-label="email"
        
        

        

        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        

        

        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              首页
            </a>
          </span>

        

      

        

      

        

          
            <span>Box2D--Physics Engine</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      文章
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="搜索...">
    </span>
    <span id="search-cancel" >取消</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->

<h1 data-toc-skip>Box2D--Physics Engine</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      发表于
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1302969600"
    data-df="YYYY/MM/DD"
    data-toggle="tooltip" data-placement="bottom">
  2011/04/17
</em>

    </span>

    <!-- lastmod date -->
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      作者

      <em>
      
        <a href="https://twitter.com/peng_jiang">Oscar</a>
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="874 字">
  <em>4 分钟</em>阅读</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p><a href="/apps.html#angry_tank">Demo</a></p>

<p>Box2D是一个强大的物理引擎(Physics Engine)，有c++, java, js等多种版本。当前流行的Angry birds游戏就使用它作为物理引擎。Wikipedia中给出的定义是：</p>
<blockquote>
  <p>A <a href="http://en.wikipedia.org/wiki/Physics">physics</a> engine is <a href="http://en.wikipedia.org/wiki/Computer_software">computer software</a> that provides an approximate <a title="Computer simulation" href="http://en.wikipedia.org/wiki/Computer_simulation">simulation</a> of certain simple <a title="Physical system" href="http://en.wikipedia.org/wiki/Physical_system">physical systems</a>, such as <a href="http://en.wikipedia.org/wiki/Rigid_body_dynamics">rigid body dynamics</a>(including <a href="http://en.wikipedia.org/wiki/Collision_detection">collision detection</a>), <a href="http://en.wikipedia.org/wiki/Soft_body_dynamics">soft body dynamics</a>, and <a title="Fluid simulation" href="http://en.wikipedia.org/wiki/Fluid_simulation">fluid dynamics</a>, of use in the <a title="wikt:domain" href="http://en.wiktionary.org/wiki/domain">domains</a> of <a href="http://en.wikipedia.org/wiki/Computer_graphics">computer graphics</a>, <a title="Video game" href="http://en.wikipedia.org/wiki/Video_game">video games</a> and <a href="http://en.wikipedia.org/wiki/Film">film</a>. Their main uses are in video games (typically as <a title="Game middleware" href="http://en.wikipedia.org/wiki/Game_middleware">middleware</a>), in which case the <a title="Simulation" href="http://en.wikipedia.org/wiki/Simulation">simulations</a> are in <a title="Real-time computer graphics" href="http://en.wikipedia.org/wiki/Real-time_computer_graphics">real-time</a>. The term is sometimes used more generally to describe any <a href="http://en.wikipedia.org/wiki/Software_system">software system</a> for simulating physical phenomena, such as <a title="High-performance computing" href="http://en.wikipedia.org/wiki/High-performance_computing">high-performance scientific simulation</a>.</p>
</blockquote>

<p>近期为了给Tankcraft做spike，实现了一个简单的坦克，包括的功能有：</p>

<ul>
  <li>左右键控制坦克前后移动</li>
  <li>上下键调整炮筒的角度</li>
  <li>空格键发射炮弹，根据炮筒角度不同炮弹运行的抛物线也不一样</li>
  <li>当运行到有坡度的地面时，坦克整体布局不发生改变</li>
</ul>

<p><a href="tank.jpg" class="popup img-link "><img data-src="tank.jpg" alt="" class="lazyload" data-proofer-ignore></a></p>

<p>其中关键技术点包括：</p>

<p>Body:</p>

<p>在Box2D中，整个界面成为一个World，World中可以创建多个不同的Body，Body可以具有质量，摩擦力，位置，形状等等属性。例如上图中坦克的底座，操作舱，轮子，炮筒，炮弹，斜坡，四周方框都是Body。Body共有三种：</p>

<ul>
  <li>staticBody：不能有任何移动和变化。例如，四周方框和斜坡</li>
  <li>dynamicBody: 可以任意移动变化。除过方框和斜坡外的其余部分都是这种类型</li>
  <li>kinematicBody：通常用于给定初始速度后可以移动的物体</li>
</ul>

<p>Body Joint:</p>

<p>多个Body之间可能毫无关系，也可能紧密结合，Body Joint就是用来处理不同Body之间关系的一个对象。共有9种Joint：</p>

<ul>
  <li>Distance Joint</li>
  <li>Friction Joint</li>
  <li>Gear Joint</li>
  <li>Line Joint</li>
  <li>Mouse Joint</li>
  <li>Prismatic Joint</li>
  <li>Pulley Joint</li>
  <li>Revolute Joint</li>
  <li>Weld Joint</li>
</ul>

<p>有一篇blog对joint讲解的非常详细：<a href="http://blog.allanbishop.com/box2d-2-1a-tutorial-part-2-joints/"></a>，这里不再详述每种joint的适用场景。只简单列举用到的两种：</p>

<ul>
  <li>
    <p>Weld Joint: 这应该是最简单最直接的一种连接，就是将两个Body绑定在某个点上。例如操作舱和坦克底部，它们彼此绑定而且没有相对移动。</p>

    <div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>  <span class="nx">joint</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2WeldJointDef</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">car_body_position</span> <span class="o">=</span> <span class="nx">car_body</span><span class="p">.</span><span class="nx">GetPosition</span><span class="p">()</span>
  <span class="nx">joint</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">(</span><span class="nx">car_body</span><span class="p">,</span> <span class="nx">car_head</span><span class="p">,</span> <span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">car_body_position</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">50</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span> <span class="nx">car_body_position</span><span class="p">.</span><span class="nx">y</span><span class="p">));</span>
  <span class="nx">world</span><span class="p">.</span><span class="nx">CreateJoint</span><span class="p">(</span><span class="nx">joint</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>Revolute Joint：这种方式是用来处理两个Body之间旋转的一种连接，例如车轮和底座之间，以及炮筒与操作舱之间。</p>

    <div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>  <span class="kd">var</span> <span class="nx">joint</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2RevoluteJointDef</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">joint_point</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">car_head</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">().</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">25</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span> <span class="nx">car_head</span><span class="p">.</span><span class="nx">GetWorldCenter</span><span class="p">().</span><span class="nx">y</span><span class="p">)</span>
  <span class="nx">joint</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">(</span><span class="nx">gun</span><span class="p">,</span> <span class="nx">car_head</span><span class="p">,</span> <span class="nx">joint_point</span><span class="p">);</span>
  <span class="nx">joint</span><span class="p">.</span><span class="nx">enableLimit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="nx">joint</span><span class="p">.</span><span class="nx">referenceAngle</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span>
  <span class="nx">gun_joint</span> <span class="o">=</span> <span class="nx">world</span><span class="p">.</span><span class="nx">CreateJoint</span><span class="p">(</span><span class="nx">joint</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>这里定义了在Joint时两个Body的初始角度差。另外要特别注意的就是，定义的joint_point是car_head的最后端，而gun的Position一定要根据car_head的Position设置正确，保证gun的最左端与joint_point重合，否则无法实现合理的绕joint_point旋转的效果！</p>
  </li>
  <li>
    <p>ApplyImpulse:
  这个用来给发出的炮弹初始速度以及角度。由于炮弹必须要沿着炮筒的方向，所以需要理解这个方法的参数含义，并且考虑几个关键点坐标来计算。</p>

    <div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>  <span class="kd">var</span> <span class="nx">bulletDef</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BodyDef</span><span class="p">;</span>
  <span class="nx">bulletDef</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">b2Body</span><span class="p">.</span><span class="nx">b2_dynamicBody</span><span class="p">;</span>
  <span class="nx">fixDef</span><span class="p">.</span><span class="nx">shape</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2CircleShape</span><span class="p">(</span>
      <span class="mi">4</span><span class="o">/</span><span class="mi">30</span>
  <span class="p">);</span>
  <span class="nx">fixDef</span><span class="p">.</span><span class="nx">friction</span> <span class="o">=</span> <span class="mi">4</span>
  <span class="nx">fixDef</span><span class="p">.</span><span class="nx">density</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="nx">fixDef</span><span class="p">.</span><span class="nx">filter</span><span class="p">.</span><span class="nx">groupIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">gun_joint_position</span> <span class="o">=</span> <span class="nx">gun_joint</span><span class="p">.</span><span class="nx">GetAnchorA</span><span class="p">()</span>
  <span class="nx">bulletDef</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">gun</span><span class="p">.</span><span class="nx">GetPosition</span><span class="p">().</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">gun_joint_position</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>  <span class="mi">2</span> <span class="o">*</span> <span class="nx">gun</span><span class="p">.</span><span class="nx">GetPosition</span><span class="p">().</span><span class="nx">y</span> <span class="o">-</span>  <span class="nx">gun_joint_position</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">bullet</span><span class="o">=</span><span class="nx">world</span><span class="p">.</span><span class="nx">CreateBody</span><span class="p">(</span><span class="nx">bulletDef</span><span class="p">);</span>
  <span class="nx">bullet</span><span class="p">.</span><span class="nx">CreateFixture</span><span class="p">(</span><span class="nx">fixDef</span><span class="p">);</span>

  <span class="nx">bullet</span><span class="p">.</span><span class="nx">ApplyImpulse</span><span class="p">(</span><span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">gun</span><span class="p">.</span><span class="nx">GetPosition</span><span class="p">().</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">gun_joint_position</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">gun</span><span class="p">.</span><span class="nx">GetPosition</span><span class="p">().</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">gun_joint_position</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span> <span class="nx">gun_joint_position</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ul>

<p>以下是一些有用的链接：</p>

<ul>
  <li><a href="http://www.box2dflash.org/docs/2.1a/reference">http://www.box2dflash.org/docs/2.1a/reference</a></li>
  <li><a href="http://www.box2d.org/manual.html">http://www.box2d.org/manual.html</a></li>
  <li><a href="http://blog.allanbishop.com/box2d1a-tutorial-part-2-oints">http://blog.allanbishop.com/box2d1a-tutorial-part-2-joints</a></li>
  <li><a href="http://www.box2d.org/index.html">http://www.box2d.org/index.html</a></li>
</ul>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/programming/'>PROGRAMMING</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/angry-birds/"
          class="post-tag no-text-decoration" >Angry Birds</a>
      
      <a href="/tags/box2d/"
          class="post-tag no-text-decoration" >Box2D</a>
      
      <a href="/tags/physics-engine/"
          class="post-tag no-text-decoration" >Physics Engine</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">分享</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Box2D--Physics%20Engine%20-%20%E5%A7%9C%E9%B9%8F%E7%9A%84%E5%8D%9A%E5%AE%A2&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fbox2d-physics-engine.html%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Box2D--Physics%20Engine%20-%20%E5%A7%9C%E9%B9%8F%E7%9A%84%E5%8D%9A%E5%AE%A2&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fbox2d-physics-engine.html%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fbox2d-physics-engine.html%2F&text=Box2D--Physics%20Engine%20-%20%E5%A7%9C%E9%B9%8F%E7%9A%84%E5%8D%9A%E5%AE%A2" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="分享链接"
        data-title-succeed="链接已复制！">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">热门标签</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/javascript/">Javascript</a>
    
      
      <a class="post-tag" href="/tags/box2d/">Box2D</a>
    
      
      <a class="post-tag" href="/tags/release/">release</a>
    
      
      <a class="post-tag" href="/tags/test/">test</a>
    
      
      <a class="post-tag" href="/tags/alipay/">alipay</a>
    
      
      <a class="post-tag" href="/tags/angry-birds/">Angry Birds</a>
    
      
      <a class="post-tag" href="/tags/coffeescript/">CoffeeScript</a>
    
      
      <a class="post-tag" href="/tags/feedback/">feedback</a>
    
      
      <a class="post-tag" href="/tags/html5/">HTML5</a>
    
      
      <a class="post-tag" href="/tags/integration/">integration</a>
    

    </div>
  </div>


    </div>

    
      
      




    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>相关文章</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/box2d-collision-detection.html/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1306857600"
    data-df="YYYY/MM/DD"
    >
  2011/06/01
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Box2D-Collision Detection</h3>
            <div class="text-muted small">
              <p>
                





                Demo

碰撞检测是物理引擎中非常重要的部分，一般分为两种：


  Discrete Collision Detection: 离散碰撞检测。
从实现的角度来说，就是在每TimeStep时刻计算所有当前物体的Contact，由于Box2D处理的都是刚体，这样如果在计算的结果中有overlap的刚体存在，那么这些物体之间必然存在碰撞关系。
  CCD(Continuos Collision...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/box2d-post-collision-detection.html/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1306857600"
    data-df="YYYY/MM/DD"
    >
  2011/06/01
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Box2D-Post Collision Detection</h3>
            <div class="text-muted small">
              <p>
                





                Demo

在检测到碰撞后，我们往往需要进行一些处理，比如在Angry Birds中当小鸟撞击到障碍或者击中猪后，会有碰撞的声音，破碎的效果等，这些都是在碰撞检测后进行处理的。



如上图，坦克发出的炮弹击中了空中飞行的物体，之后炮弹消失，物体旋转下落。

实现的代码如下

1
2
3
4
5
6
7
8
9
10
11
12
var contactListener = new Box2D...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/secret-of-rails-csrf-token.html/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1411660800"
    data-df="YYYY/MM/DD"
    >
  2014/09/26
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Rails CSRF token 探秘</h3>
            <div class="text-muted small">
              <p>
                





                CSRF(Cross-Site Request Forgery)是一种常见的攻击手段，Rails中下面的代码帮助我们的应用来阻止CSRF攻击。

1
2
3
4
5
class ApplicationController &amp;lt; ActionController::Base
  # Prevent CSRF attacks by raising an exception.
  # For ...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/validation-refactor.html/" class="btn btn-outline-primary"
    prompt="上一篇">
    <p>Validation Refactor -- Command Pattern</p>
  </a>
  

  
  <a href="/posts/box2d-collision-detection.html/" class="btn btn-outline-primary"
    prompt="下一篇">
    <p>Box2D-Collision Detection</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">热门标签</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/javascript/">Javascript</a>
    
      
      <a class="post-tag" href="/tags/box2d/">Box2D</a>
    
      
      <a class="post-tag" href="/tags/release/">release</a>
    
      
      <a class="post-tag" href="/tags/test/">test</a>
    
      
      <a class="post-tag" href="/tags/alipay/">alipay</a>
    
      
      <a class="post-tag" href="/tags/angry-birds/">Angry Birds</a>
    
      
      <a class="post-tag" href="/tags/coffeescript/">CoffeeScript</a>
    
      
      <a class="post-tag" href="/tags/feedback/">feedback</a>
    
      
      <a class="post-tag" href="/tags/html5/">HTML5</a>
    
      
      <a class="post-tag" href="/tags/integration/">integration</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          © 2023
          <a href="https://twitter.com/peng_jiang">Oscar</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。
        </p>
      </div>
    </div>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">发现新版本的内容。</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            更新
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">搜索结果为空</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script>






  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/zh.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

